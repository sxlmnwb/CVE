TRUE=$(shell which true)
WHOAMI=$(shell which whoami)

CFLAGS=-Wall -DTRUE='"${TRUE}"' -DWHOAMI='"${WHOAMI}"'

.PHONY: all
all: exploit-centos

.PHONY: clean
clean:
	rm -rf exploit-centos pwnkit-centos.so_data.h pwnkit-centos.so

%.so: %.c
	$(CC) $(CFLAGS) --shared -fPIC -o $@ $<

%.so_data.h: %.so
	echo "#ifndef __PWNKIT_SO_DATA_H" >>$@
	echo "#define __PWNKIT_SO_DATA_H" >>$@
	xxd -i $<                         >>$@
	echo "#endif"                     >>$@

exploit-centos: exploit-centos.c pwnkit-centos.so_data.h
	$(CC) $(CFLAGS) -o $@ $<
